$(function(){var e=$("#data_mtg_num").val();var M=$("#data_mtg_id").val();var aA=$("#data_req_id").val();var Z=$("#launch_msg");var Q=$("#launch_plugin");var L=$("#scheme_container");var ae=$("#action_container");var u=$("#download_container");var z=$("#plugin_container");var q=$("#enable_chrome_plugin_tip").appendTo(document.body);var ao=$("#enable_firefox_plugin_tip").appendTo(document.body);var aw=$("#enable_chrome_download_tip").appendTo(document.body);var k=$("#enable_firefox_download_tip").appendTo(document.body);var am=$("#enable_safari_download_tip").appendTo(document.body);var W=$("#action").val();var Y=$("#scheme").val();var ad=$("#join_url").val();var I=$("#scheme_url").val();var aE=$("#download_url").val();var D=$("#plugin_type").val();var G=$("#from").val();var i=null;var al=false;var j=false;var C=false;var A=false;var aG=false;var m=false;var av=false;var s=false;var c=false;var f=false;if(SB.isChromeOS||$("#chrome_app_id").val()){f=true}var N=0,ah=0,ag=0;var F=navigator.userAgent.toLowerCase(),aF;if(SB.isFirefox){aF=F.match(/firefox\/([\d]+)/);if(aF){N=parseInt(aF[1],10)}}else{if(SB.isChrome){aF=F.match(/chrome\/([\d]+)/);if(aF){ah=parseInt(aF[1],10)}}else{if(SB.isSafari){aF=F.match(/version\/([\d]+)[\d\.]* safari\/[\d]+/);if(aF){ag=parseInt(aF[1],10)}}else{if(SB.isIE){aF=F.match(/windows nt ([\d]+)\.([\d]+)/);if(aF){var U=parseInt(aF[1],10);var T=parseInt(aF[2],10);if(U<6||U==6&&T<1){s=true}}aF=F.match(/msie ([\d.]+)/);if(aF){var U=parseInt(aF[1],10);if(U<9){s=true}}if(SB.isWin){aF=F.match(/zoom ([\d]+)\.([\d]+)/);if(aF){var U=parseInt(aF[1],10);var T=parseInt(aF[2],10);if(U>3||U==3&&T>=5){c=true}}}}}}}var az=false;if(SB.isMac){aF=F.match(/mac os x ([\d]+)(\.|_)([\d]+)/);if(aF){var U=parseInt(aF[1],10);var T=parseInt(aF[3],10);if(U>10||U==10&&T>=12){az=true}}}if(SB.isMac&&(SB.isChrome||SB.isOpera)){var aC=$("#download_name").val();if(az||$("#disable_launcher").val()){aE=$("#full_package_url").val()}else{aE=$("#launcher_url").val();aC=$("#launcher_name").val()}$("a.download-url").attr("href",aE);$(".download-name").text(aC)}if(s){I=I.replace(/&pp=.*/,"")}window.log=function(aJ){if(window.console&&window.console.log){window.console.log(aJ)}};function aq(aJ){if(SB.isFirefox){window.setTimeout(function(){window.location.replace(SB.contextPath+aJ)},1000*10)}else{window.location.replace(SB.contextPath+aJ)}}function H(){window.setTimeout(function(){if(ad.indexOf("?")>=0){aq(ad+"&status=npsuccess")}else{aq(ad+"?status=npsuccess")}},500)}function g(){l();window.setTimeout(function(){if(ad.indexOf("?")>=0){aq(ad+"&status=success"+(f?"&from=cc":""))}else{aq(ad+"?status=success"+(f?"&from=cc":""))}},(SB.isOpera||SB.isSafari||f)?60000:500)}function n(){aH();K();if(SB.isMac){if(!(SB.isChrome||(SB.isSafari&&ag>=12))){A=false;ax()}if(SB.isChrome&&ah<42){ax()}}}function aa(){return ah>=37}function S(){return N>=25}function ab(){return N>=27}function af(){if(N<29){$("#firefox_plugin_tip").css("padding-top","15px");$("#firefox_plugin_tip .arrow").css("bottom","10px")}}function b(){$(document.body).addClass("top-tip")}function ac(){$(document.body).removeClass("top-tip")}function v(aJ){Z.html(aJ).parent().show()}function aH(){Z.parent().hide()}function h(){if(m){return}m=true;aH();ae.hide();z.show();if(SB.isFirefox){if(ab()){if(Q){Q.addClass("firefox");z.addClass("firefox30");$("#embed_container").addClass("firefox30");Q.before(z.find(".desc13"))}af();$("#firefox_plugin_tip").show()}}else{if(SB.isSafari){$("#safari_plugin_tip").show()}else{$("#chrome_plugin_tip").show()}}if(aa()){J(q,{top:8},{top:100})}else{if(S()){J(ao,{top:8},{top:100})}}}function aD(){z.hide();if(Q){Q.removeClass("firefox")}$("#embed_container").find(".desc13").hide();q.hide();ao.hide()}function J(aJ,aL){var aK=$.extend({},aL,{opacity:1});aJ.show();aJ.animate(aK,{duration:2000,easing:"easeOutBounce"})}function E(){aD();K();if(SB.isSafari&&ag<8){am.find("i").addClass("safari7")}if(SB.isMac){if(SB.isChrome){J(aw,{bottom:8});return}if(SB.isSafari){window.setTimeout(function(){J(am,{top:8})},2000);return}}else{if(SB.isWin){if(SB.isChrome){window.setTimeout(function(){J(aw,{bottom:8})},2000);return}if(SB.isFirefox){window.setTimeout(function(){J(k,{top:8})},3000);return}if(SB.isSafari){window.setTimeout(function(){J(am,{top:8})},2000);return}}}}function ay(){aw.hide();am.hide();ae.hide()}function K(){ae.show()}function r(){if(aG){return}aG=true;aD();E();if(G=="msft"){return}if(SB.isLinux){if(SB.isFirefox){SB.jump("/download")}}else{$('<iframe id="download_frame" style="width:0;height:0;" src="'+aE+'" frameborder="0" title="Inline Download Frame"></iframe>').appendTo(document.body)}SB.sendJMF(e,M,aA,"download_launcher",aE);l()}function O(aK){v($.i18n.get("join.meeting_preparing"));ay();aD();ac();var aN=JSON.parse($("#plugin_params").val());var aJ=-1;try{if(SB.isMac){aJ=aK.launchApplication($.param(aN))}else{var aM;for(aM in aN){if(aN.hasOwnProperty(aM)){aK.setParameter(aM,aN[aM])}}aJ=aK.launchApplication()}}catch(aL){log("[launch.js] launch plugin error: "+aL)}log("[launch.js] launch plugin result: "+aJ);SB.sendJMF(e,M,aA,"launch_plugin","result:"+aJ);switch(aJ){case 0:H();break;case -1:case 1:case 2:if(SB.isChrome){v($.i18n.get("join.close_chrome_try_again"))}else{if(SB.isFirefox){v($.i18n.get("join.close_firefox_try_again"))}else{v($.i18n.get("join.close_browser_try_again"))}}break;case 3:v($.i18n.get("join.update_version_try_again"));break}}var at=true;window.callback_check_plugin=function(aK,aL,aJ){if(aJ==="available"){return ap(aL,aK)}else{if(aJ==="blocked"){return w(aL)}else{if(aJ==="app_not_found"){return aj()}else{return ai()}}}};function ax(){var aJ=SB.contextPath+"/check_plugin?t="+encodeURIComponent(D);var aL=$("#check_plugin_frame");var aK;if(aL.length==0){aL=$('<iframe id="check_plugin_frame" style="width:0;height:0;" src="'+aJ+'" frameborder="0" title="Inline Check Frame"></iframe>').appendTo(document.body);aK=aL[0].contentWindow}else{aK=aL[0].contentWindow;aK.checkPlugin()}}function B(){if(i){window.clearTimeout(i)}i=window.setTimeout(ax,1000)}function ap(aK,aJ){log("[launch.js] plugin exists, and ready to run: "+aK);if(at){SB.sendJMF(e,M,aA,"check_plugin_success","plugin exists:"+aK);at=false}if(al&&SB.isMac&&!SB.isChrome){if(ad.indexOf("?")>=0){window.location.href=ad+"&_="+Math.floor(Math.random()*100)}else{window.location.href=ad+"?_="+Math.floor(Math.random()*100)}return false}j=SB_CHECK_SCHEME(aK);if(j){ar();if(SB.isMac&&!SB.isChrome){B()}return SB.isMac}O(aJ);return false}function w(aJ){log("[launch.js] plugin exists, but blocked by browser: "+aJ);if(at){SB.sendJMF(e,M,aA,"check_plugin_blocked","plugin exists:"+aJ);at=false}if(al){if(SB.isMac&&!SB.isChrome){if(ad.indexOf("?")>=0){window.location.href=ad+"&_="+Math.floor(Math.random()*100)}else{window.location.href=ad+"?_="+Math.floor(Math.random()*100)}}return false}j=SB_CHECK_SCHEME(aJ);if(j){ar();if(SB.isMac&&!SB.isChrome){B()}return SB.isMac}aH();ay();h();B();return true}function aj(){log("[launch.js] plugin exists, but app not found");if(at){SB.sendJMF(e,M,aA,"check_plugin_no_app","plugin exist no app");at=false}al=true;aH();r();if(SB.isMac&&!SB.isChrome){B()}return SB.isMac}function ai(){log("[launch.js] plugin not exist");if(at){SB.sendJMF(e,M,aA,"check_plugin_not_exist","plugin not exist");at=false}al=true;if(SB.isMac&&SB.isChrome&&ah<42){aH();r()}else{if(SB.isIE||SB.isChrome||SB.isFirefox){ar()}else{aH();r()}}if(SB.isMac&&!SB.isChrome){B()}return SB.isMac}function P(){log("[launch.js] launch scheme in iframe ...");$("#launch_scheme_frame").remove();var aJ=$('<iframe id="launch_scheme_frame" style="width:0;height:0;" frameborder="0" title="Inline Launch Frame"></iframe>');aJ.attr("src",I);aJ.appendTo(document.body);SB.sendJMF(e,M,aA,"launch_protocol","method:iframe");window.setTimeout(function(){g()},1000)}function aI(){log("[launch.js] launch scheme via location ...");top.location.href=I;SB.sendJMF(e,M,aA,"launch_protocol","method:location");window.setTimeout(function(){g()},1000)}function ak(aN){var aQ=aN.getFullYear();var aJ=aN.getMonth()+1;var aP=aN.getDate();var aM=aN.getHours();var aO=aN.getMinutes();var aL=aN.getSeconds();var aK=aN.getMilliseconds();return aQ+"-"+aJ+"-"+aP+" "+aM+":"+aO+":"+aL+"."+aK}var V="_zm_launcher";function R(){var aJ=$.cookie(V);if(!aJ){return false}return true}function a(){return(SB.isChrome&&ah>=42)||SB.isEdge||SB.isOpera||(SB.isSafari&&ag>=12)||(SB.isFirefox&&N>=64)}function l(){if(!a()){return}try{var aK=""+(new Date().getTime());$.cookie(V,aK,{expires:100*365,path:"/",domain:SB.cookieDomain})}catch(aJ){}}function au(){var aO=false;var aL=null;var aM=$('<input id="launcher_focus"  aria-label="Inline Launcher Focus" style="display:none;position:absolute;z-index:9999;width:1px;height:1px;max-width:1px;max-height:1px;top:0;left:0;"/>');aM.appendTo(document.body);function aP(){log("[launch.js] onblur, app exists, "+ak(new Date()));aM.off("blur",aP);aM.hide();if(document.hidden){document.addEventListener("visibilitychange",aJ)}else{aO=true;if(aL){window.clearTimeout(aL);aL=null}aK()}}function aK(){aM.off("blur",aP);aM.hide();if(aO||av){if(!aO){SB.sendJMF(e,M,aA,"Chrome_launch_protocol","lastSuccessButBlurFail")}SB.sendJMF(e,M,aA,"Chrome_launch_protocol","success cookie:"+(av?"exist":"no"));g()}else{if(SB_SUPPORT_SCHEME){SB.sendJMF(e,M,aA,"Chrome_launch_protocol","failure but support protocol");g()}else{SB.sendJMF(e,M,aA,"Chrome_launch_protocol","failure not support protocol");n();r()}}}function aJ(){if(!document.hidden){document.removeEventListener("visibilitychange",aJ);aN();return}SB.sendJMF(e,M,aA,"Chrome_launch_protocol","retryFail:hidden="+document.hidden+";visibilityState="+document.visibilityState)}function aN(){if(document.hidden){log("[launch.js] hidden: true, do nothing - "+ak(new Date()));document.addEventListener("visibilitychange",aJ)}else{log("[launch.js] hidden: false, launching - "+ak(new Date()));aM.show();aM.focus();aM.on("blur",aP);if(SB.isChrome&&ah<40){log("[launch.js] launch scheme via location ...");top.location.href=I;SB.sendJMF(e,M,aA,"Chrome_launch_protocol","method:location")}else{log("[launch.js] launch scheme in iframe ...");$("#launch_scheme_frame").remove();var aQ=$('<iframe id="launch_scheme_frame" style="width:0;height:0;" frameborder="0" title="Inline Launch Frame"></iframe>');aQ.attr("src",I);aQ.appendTo(document.body);SB.sendJMF(e,M,aA,"Chrome_launch_protocol","method:iframe")}aL=setTimeout(function(){log("[launch.js] timeout, hidden: "+document.hidden+", success: "+aO+" - "+ak(new Date()));if(document.hidden){document.addEventListener("visibilitychange",aJ)}else{aK()}},(SB.isMac?5000:2000))}}window.setTimeout(aN,300)}function t(){if(av){log("[launch.js] launch scheme in edge success before, assume support protocol");SB.sendJMF(e,M,aA,"Edge_check_protocol","cookie:exist");au();return}log("[launch.js] not launch scheme in edge before, assume not support protocol");SB.sendJMF(e,M,aA,"Edge_check_protocol","cookie:no");n();r()}function p(){if(av){log("[launch.js] launch scheme in Opera success before, assume support protocol");SB.sendJMF(e,M,aA,"Opera_check_protocol","cookie:exist");au();return}log("[launch.js] not launch scheme in edge before, assume not support protocol");SB.sendJMF(e,M,aA,"Opera_check_protocol","cookie:no");n();r()}function x(){if(a()&&!av){SB.sendJMF(e,M,aA,"FF_launch_protocol","cookie:no");n();r();return}$("#launch_scheme_frame").remove();var aJ=$('<iframe id="launch_scheme_frame" src="about:blank" style="width:0;height:0;" frameborder="0" title="Inline Launch Frame"></iframe>').appendTo(document.body);try{aJ[0].contentWindow.location.href=I;log("[launch.js] launch scheme in firefox success");SB.sendJMF(e,M,aA,"FF_launch_protocol","location:success");g()}catch(aK){log("[launch.js] launch scheme in firefox failure: "+aK.name);if("NS_ERROR_UNKNOWN_PROTOCOL"===aK.name){log("launch scheme in firefox failure, no application installed");SB.sendJMF(e,M,aA,"FF_launch_protocol","location:failure");n();r()}}}function an(){navigator.msLaunchUri(I,function(){log("[launch.js] launch scheme via msLaunchUri success");SB.sendJMF(e,M,aA,"IE_launch_protocol","msLaunchUri:success");g()},function(){log("[launch.js] launch scheme via msLaunchUri failure");SB.sendJMF(e,M,aA,"IE_launch_protocol","msLaunchUri:failure");o()})}function y(){return false}function o(){if(c){j=true;SB.sendJMF(e,M,aA,"IE_check_protocol","UA:success")}else{var aJ=document.createElement("a");aJ.setAttribute("style","visibility:hidden;display:none");aJ.setAttribute("href","https://test."+Y);aJ=document.body.appendChild(aJ);log("[launch.js] detect scheme in IE: "+aJ.mimeType);j=SB_CHECK_SCHEME(aJ.mimeType);SB.sendJMF(e,M,aA,"IE_check_protocol","No Zoom UA; mimeType:"+(j?"success":"failure")+" "+aJ.mimeType)}if(j){if(s){aI()}else{P()}}else{n();if(!C){r()}}}function ar(){if(A){return}A=true;if(SB.isIE){var aJ=y();if(aJ){an()}else{o()}}else{if(SB.isChrome||(SB.isSafari&&ag>=12)){au()}else{if(SB.isEdge){t()}else{if(SB.isOpera){p()}else{if(SB.isFirefox){x()}else{P()}}}}}}$("#safari_plugin_tip_container .allow-plugins-tip").click(function(){$("#safari_plugin_tip_container .tips").slideToggle()});av=R();function X(){v('<i class="busy busy24"></i>');$("#launch_downloadUrl").show();log("[launch.js] try to detect and launch by protocol");if(SB_SUPPORT_SCHEME){SB.sendJMF(e,M,aA,"check_protocol","plugin:success "+SB_PLUGIN_NAME);window.setTimeout(ar,1000)}else{if(a()){SB.sendJMF(e,M,aA,"check_protocol","plugin:failure "+SB_PLUGIN_NAME);log("[launch.js] last success: "+av);window.setTimeout(ar,1000)}else{SB.sendJMF(e,M,aA,"check_protocol","plugin:failure "+SB_PLUGIN_NAME);ax()}}}function d(){if(chrome.runtime&&chrome.runtime.sendMessage){var aK=$("#chrome_app_id").val();var aJ={meetingid:$("#data_mtg_num").val(),password:$("#data_pwd").val(),username:$("#data_uname").val(),wtk:$("#data_wtk").val(),uid:$("#data_uid").val(),token:$("#data_token").val(),stype:$("#data_stype").val(),tid:$("#chrome_app_tid").val(),email:$("#chrome_app_email").val(),zak:$("#chrome_app_zak").val(),zakt:$("#chrome_app_zakt").val()};chrome.runtime.sendMessage(aK,aJ,function(aL){if(aL){log("[launch.js] launch chrome app success");$("#installed_container").show();$("#install_container").hide();g()}else{log("[launch.js] launch chrome app failure");log(chrome.runtime.lastError);$("#installed_container").hide();$("#install_container").show();window.setTimeout(d,1000)}})}}function aB(aM){if(!SB.isMac){aM.error();return}if($("#lhs_ports").length==0){aM.error();return}var aQ=[],aP=$("#lhs_ports").val().split(","),aL=$("#lhs_check_params").val()+"&uuid="+$("#lhs_uuid").val(),aN=$("#lhs_launch_params").val()+"&wc="+$("#lhs_wc_url").val()+"&uuid="+$("#lhs_uuid").val();var aK=$.map(aP,function(aR,aS){var aT=new Image();aT.id=aR;aT.title=$.now();aT.onload=function(){window.clearTimeout(aO);log("[launch.js] Load detectPortImage success, url="+this.src+", duration="+($.now()-this.title));var aY=this.width,aV=this.height;if(!(aY===1&&aV===6)){SB.sendJMF(e,M,aA,"check_lhs","fail_unsupport_version");aJ();return}var aX=this.id;var aW=new Image();aW.id=aX;aW.title=$.now();aW.onload=function(){var a0=function(a5,a3){var a4=a5.width,a1=a5.height;var a2={"1_1":"success","1_2":"start_download","1_3":"end_download","1_4":"start_install","1_5":"end_install","1_6":"available_version","2_1":"fail_check_upgrade","2_2":"fail_download_cancel","2_3":"fail_download","3_1":"fail_install","3_2":"fail_launch","4_1":"fail_uuid","4_2":"fail_disk_full","5_1":"fail_unknown","6_1":"fail_invalid_domain"};var a6=a2[a4+"_"+a1];log("[launch.js] width="+a4+", height="+a1+", jmf_reason="+a6);if(a4!==1){aU(a6);return}if(a1===1){log("[launch.js] launch by LHS success.");aZ(a6);SB.sendJMF(e,M,aA,"launch_lhs",a6);aM.success();return}window.setTimeout(function(){var a7=new Image();a7.onload=function(){a0(this,a3)};a7.onerror=a7.onabort=function(){aU("fail_load_app_check")};a7.src=a3+"&t="+$.now();log("[launch.js] Start to load detectStatusImage, url="+a7.src)},aM.interval)};log("[launch.js] Load launchImage success, url="+this.src+", duration="+($.now()-this.title));a0(this,"http://localhost:"+this.id+"/app_check?"+aL+"&action=detectStatus")};aW.onerror=aW.onabort=function(){log("[launch.js] Load launchImage fail, url="+this.src+", duration="+($.now()-this.title));aU("fail_load_launch")};var aZ=function(a1){var a0="#lhs_"+((a1==="success"||a1==="fail_uuid")?a1:"fail");$("#launch_msg").html($(a0).html())};var aU=function(a0){log("[launch.js] "+a0);SB.sendJMF(e,M,aA,"launch_lhs",a0);if(a0==="fail_invalid_domain"){aM.error()}else{aZ(a0)}};aW.src="http://localhost:"+aX+"/launch?"+aN+"&t="+$.now();log("[launch.js] Start to load launchImage, url="+aW.src)};aT.onerror=aT.onabort=function(){log("[launch.js] Load detectPortImage fail, url="+this.src+", duration="+($.now()-this.title));var aU=this.id;if($.inArray(aU,aQ)===-1){aQ.push(aU)}if(aQ.length===aP.length){window.clearTimeout(aO);log("[launch.js] detect ports fail.");SB.sendJMF(e,M,aA,"check_lhs","fail_load_app_check");aJ()}};aT.src="http://localhost:"+aR+"/app_check?action=checkVersion&"+aL+"&t="+$.now();log("[launch.js] Start to load detectPortImage, url="+aT.src);return aT});var aJ=function(){$.each(aK,function(aR,aS){aS.onload=aS.onerror=aS.onabort=null});aM.error()};var aO=window.setTimeout(function(){log("[launch.js] detect ports timeout.");SB.sendJMF(e,M,aA,"check_lhs","fail_load_app_check_timeout");aJ()},aM.timeout)}if(f&&SB.isChrome){d()}else{aB({timeout:1000*5,interval:1000*3,success:function(){l();if($(".webclient:visible").length===0){window.setTimeout(function(){$(".webclient").show()},5000)}window.setTimeout(function(){if(ad.indexOf("?")===-1){aq(ad+"?status=success&timeout=1")}else{aq(ad+"&status=success&timeout=1")}},300000)},error:function(){X()}})}});